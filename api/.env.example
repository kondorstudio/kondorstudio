##############################################
# KONDOR STUDIO ‚Äî API (.env.example)
# Copiar para .env e preencher os valores.
##############################################

##############################
# üåç AMBIENTE / SERVIDOR
##############################
NODE_ENV=development
PORT=4000

##############################
# üóÑÔ∏è BANCO DE DADOS
##############################
# Exemplo (PostgreSQL gerenciado em qualquer provedor):
# postgres://user:pass@host:5432/dbname?sslmode=require
# Dica prod: defina pool no runtime (ex.: ...?sslmode=require&connection_limit=5&pool_timeout=30)
DATABASE_URL=

# URL opcional usada apenas em migrations de deploy (pode apontar para pool menor).
# Se vazio, usa DATABASE_URL.
PRISMA_MIGRATE_DATABASE_URL=
PRISMA_MIGRATE_MAX_RETRIES=8
PRISMA_MIGRATE_RETRY_DELAY_MS=3000
PRISMA_MIGRATE_BACKOFF_MULTIPLIER=1.8
PRISMA_MIGRATE_MAX_DELAY_MS=30000
PRISMA_MIGRATE_CONNECTION_LIMIT=1
PRISMA_MIGRATE_POOL_TIMEOUT=30
PRISMA_MIGRATE_CONNECT_TIMEOUT=15
PRISMA_MIGRATE_PGBOUNCER=false

##############################
# üß¨ PRISMA / LOGS
##############################
PRISMA_LOG=
PRISMA_AUTOFIX_SCHEMA=false
# Ajustes de pool em runtime (aplicados automaticamente na DATABASE_URL se nao existir query params)
PRISMA_CONNECTION_LIMIT=3
PRISMA_POOL_TIMEOUT=30
PRISMA_CONNECT_TIMEOUT=15
PRISMA_PGBOUNCER=false

##############################
# üî• REDIS / FILAS
##############################
REDIS_URL=
REDIS_DISABLED=false
# Prefixo BullMQ para isolar filas por ambiente no mesmo Redis
# Ex.: local => kondor:dev | prod => kondor:prod
BULLMQ_PREFIX=kondor:dev
# Rotas legadas (reports/reporting): keep-compat por padr√£o
REPORTING_V1_ENABLED=true
REPORTS_LEGACY_ENABLED=true
# warn = permite e adiciona headers + telemetria | block = responde 410
LEGACY_ROUTES_MODE=warn
# Data opcional para header Sunset (RFC1123/ISO)
LEGACY_ROUTES_SUNSET_AT=
# Throttle de logs de uso das rotas legadas (ms)
LEGACY_ROUTE_LOG_TTL_MS=60000
RAW_API_DISABLED=false
RAW_API_RETENTION_DAYS=30
RAW_API_MAX_PAYLOAD_BYTES=1000000
RAW_API_MAX_ROWS=2000
WAREHOUSE_STAR_SYNC_DISABLED=false

# ===============================
# RELIABILITY LAYER (SPRINT 2)
# ===============================
# Timeout padr√£o por chamada externa (ms)
RELIABILITY_TIMEOUT_MS=20000
# Tentativas totais (1 = sem retry)
RELIABILITY_MAX_ATTEMPTS=3
# Backoff exponencial base (ms)
RELIABILITY_BASE_DELAY_MS=250
# Teto do backoff (ms)
RELIABILITY_MAX_DELAY_MS=5000
# Jitter aleat√≥rio (ms)
RELIABILITY_JITTER_MS=250
# Limiter por provider+connection (janela fixa)
RELIABILITY_RATE_LIMIT_MAX=60
RELIABILITY_RATE_LIMIT_WINDOW_MS=60000
# Circuit breaker
RELIABILITY_CIRCUIT_FAILURE_THRESHOLD=5
RELIABILITY_CIRCUIT_OPEN_MS=30000

# ===============================
# WORKERS / JOBS (FASE 4)
# ===============================

# Intervalo de polling de alguns workers legados baseados em setTimeout
WORKER_POLL_INTERVAL=5000

# N√∫mero m√°ximo de tentativas antes de marcar um job como failed
WORKER_MAX_ATTEMPTS=5

# Per√≠odo de agrega√ß√£o de m√©tricas (ms)
METRICS_AGG_PERIOD_MS=3600000

# Per√≠odo de gera√ß√£o de relat√≥rios (ms)
REPORTS_GENERATION_PERIOD_MS=900000

# Per√≠odo de automa√ß√£o de WhatsApp (ms)
WHATSAPP_AUTOMATION_PERIOD_MS=300000

# Backoff padr√£o para jobs de m√©tricas (ms)
METRICS_BACKOFF_MS=60000

# Backoff padr√£o para jobs de relat√≥rio (ms)
REPORT_BACKOFF_MS=60000

# Backoff fixo opcional para WhatsApp (ms). Se vazio, usa backoff exponencial.
WHATSAPP_BACKOFF_MS=

# Evita enfileirar jobs iguais em excesso
AUTOMATION_MAX_SIMILAR_JOBS=5

# Agendador de publica√ß√£o de posts (ms). 0 desativa
POSTS_PUBLISH_PERIOD_MS=60000
# Quantidade por lote no scheduler
POST_PUBLISH_BATCH_SIZE=5
# TTL do lock de publica√ß√£o (min)
POST_PUBLISH_LOCK_TTL_MINUTES=15

# Atualiza√ß√£o autom√°tica do dashboard (ms). 0 desativa
DASHBOARD_REFRESH_PERIOD_MS=0

# ===============================
# GA4 SYNC JOBS (BullMQ)
# ===============================
# Sincroniza facts di√°rios (rolling window) para GA4. 0 desativa
GA4_FACT_SYNC_PERIOD_MS=3600000
# Atualiza cache de realtime GA4 (rolling ~30 min). 0 desativa
GA4_REALTIME_SYNC_PERIOD_MS=60000
# Remove caches expirados e logs antigos (ms). 0 desativa
GA4_PRUNE_PERIOD_MS=86400000

# Alertas de falha em jobs (via SES). Se vazio, n√£o envia alertas.
JOB_ALERT_EMAIL=
# Throttle para evitar spam de alertas (ms)
JOB_ALERT_THROTTLE_MS=300000

##############################
# üîê JWT / AUTENTICA√á√ÉO
##############################
JWT_SECRET=
JWT_EXPIRES_IN=7d
REFRESH_TOKEN_EXPIRES_IN=30d
HASH_ROUNDS=12

# Cookies de autentica√ß√£o (opcional)
AUTH_ACCESS_COOKIE=kondor_access_token
AUTH_REFRESH_COOKIE=kondor_refresh_token
AUTH_REFRESH_ID_COOKIE=kondor_refresh_id
CLIENT_ACCESS_COOKIE=kondor_client_token

##############################
# üîê MFA ADMIN (EMAIL)
##############################
SES_REGION=
SES_SOURCE_EMAIL=
MFA_CODE_TTL_MINUTES=10
MFA_MAX_ATTEMPTS=5
ADMIN_MFA_ENABLED=true
MFA_FAIL_OPEN_WHEN_EMAIL_UNAVAILABLE=true

##############################
# üïµÔ∏è IMPERSONA√á√ÉO
##############################
IMPERSONATION_SESSION_TTL_MINUTES=60
IMPERSONATION_TOKEN_EXPIRES_IN=15m

##############################
# üîê CRIPTOGRAFIA (TOKENS)
##############################
# Chave forte (m√≠n 32 chars) usada para criptografar tokens no banco (AES-256-GCM).
# N√£o coloque valor real aqui; defina no ambiente (.env / App Platform / Droplet).
# Em produ√ß√£o, mantenha exatamente o mesmo valor em API e worker.
CRYPTO_KEY=

##############################
# üìä GA4 OAUTH / ANALYTICS
##############################
GOOGLE_OAUTH_CLIENT_ID=
GOOGLE_OAUTH_CLIENT_SECRET=
# Exemplo: https://api.seudominio.com/api/integrations/ga4/oauth/callback
GOOGLE_OAUTH_REDIRECT_URI=
GOOGLE_OAUTH_SCOPES=openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/analytics.readonly
# Chave 32 bytes (base64 ou hex) para criptografar refresh tokens GA4.
# Se CRYPTO_KEY e ENCRYPTION_KEY estiverem preenchidas, elas devem resolver para a mesma chave.
ENCRYPTION_KEY=
# Chaves legadas opcionais para fallback de decripta√ß√£o durante transi√ß√£o/rota√ß√£o.
# Nunca usadas para criptografar novos tokens (somente decrypt fallback).
CRYPTO_KEY_PREVIOUS=
ENCRYPTION_KEY_PREVIOUS=
# URL p√∫blica do front (ex.: https://kondorstudio.app)
APP_URL_FRONT=
API_URL=
GA4_MOCK_MODE=false
# For√ßa prompt=consent no OAuth GA4 para garantir refresh token na conex√£o.
# Defina false apenas se quiser reduzir fric√ß√£o de consentimento.
GA4_OAUTH_ALWAYS_CONSENT=true
# Redis opcional para cache/limite GA4 (compartilhado entre inst√¢ncias)
GA4_REDIS_DISABLED=false
GA4_REDIS_URL=
GA4_CONCURRENCY_TTL_MS=30000
GA4_CONCURRENCY_WAIT_MS=200
GA4_CACHE_DISABLED=false
GA4_CACHE_TTL_MS=120000
GA4_REALTIME_CACHE_TTL_MS=15000
GA4_METADATA_TTL_MS=86400000
GA4_MAX_CONCURRENT=5
GA4_RATE_LIMIT_WINDOW_MS=60000
GA4_RATE_LIMIT_MAX=60
GA4_TOKEN_SKEW_MS=300000
GA4_CACHE_CLEANUP_MS=300000
GA4_QUEUE_IDLE_TTL_MS=600000
GA4_DB_CACHE_DISABLED=false
GA4_API_CALL_LOG_DISABLED=false
GA4_API_CALL_LOG_RETENTION_DAYS=90
GA4_API_CALL_LOG_MAX_BYTES=750000
GA4_API_CALL_LOG_MAX_ROWS=2000
GA4_DATA_API_VERSION=v1beta
GA4_HTTP_TIMEOUT_MS=20000
GA4_HTTP_MAX_ATTEMPTS=3
GA4_HTTP_RETRY_DELAY_MS=250
GA4_MAX_METRICS=10
GA4_MAX_DIMENSIONS=10
GA4_MAX_LIMIT=10000
GA4_MAX_OFFSET=1000000
GA4_MAX_TOTAL_ROWS=50000
GA4_FILTER_MAX_BYTES=20000
GA4_FILTER_MAX_DEPTH=8
GA4_FILTER_MAX_NODES=200
GA4_BATCH_MAX_REQUESTS=5
GA4_ADMIN_PAGE_SIZE=200
GA4_OAUTH_DEBUG=false
GA4_LEAD_EVENT_NAME=
GA4_CONVERSION_EVENT_NAME=
GA4_FACT_CACHE_TTL_MS=30000
GA4_FACT_MAX_ROWS=50000
GA4_FACT_INSERT_CHUNK=500
GA4_FACT_SYNC_DAYS=30
GA4_FACT_SYNC_MAX_BRANDS_PER_RUN=0
GA4_REALTIME_SYNC_MAX_PROPERTIES_PER_RUN=0
GA4_REALTIME_SYNC_METRICS=activeUsers
GA4_REALTIME_SYNC_DIMENSIONS=
GA4_REALTIME_SYNC_CACHE_TTL_MS=15000
DEFAULT_CURRENCY=BRL
GA_DEFAULT_METRICS=

##############################
# üåê CORS / URLS P√öBLICAS
##############################
# Lista separada por v√≠rgula (sem espa√ßos).
# Exemplo local: http://localhost:5173,http://localhost:4173
# Exemplo produ√ß√£o (DigitalOcean): https://kondorstudio.app,https://www.kondorstudio.app
CORS_ORIGINS=
# Compat (legado)
CORS_ORIGIN=
# Libera todas as origens (cuidado em produ√ß√£o)
CORS_ALLOW_ALL=false
# Dom√≠nio p√∫blico do painel/front (usado em callbacks, links e redirecionamentos)
PUBLIC_APP_URL=
APP_PUBLIC_URL=
APP_BASE_URL=
# Dom√≠nio p√∫blico da API
API_BASE_URL=
API_PUBLIC_URL=
PUBLIC_APP_BASE_URL=
PUBLIC_PORTAL_URL_BASE=
# Compat legado (migra√ß√£o Render -> DigitalOcean)
RENDER_EXTERNAL_URL=
# Usado para redirecionar callbacks OAuth para o painel.
APPROVAL_PUBLIC_LINK_TTL_HOURS=72

##############################
# ‚úÖ APROVA√á√ïES / LINKS P√öBLICOS
##############################
APPROVAL_LINK_TTL_DAYS=7
POST_APPROVAL_TTL_DAYS=7
PUBLIC_APPROVALS_RATE_WINDOW_MS=60000
PUBLIC_APPROVALS_RATE_MAX=30
PUBLIC_APPROVALS_RATE_MAX_KEYS=10000

##############################
# üì¶ S3 / STORAGE
##############################
S3_ENDPOINT=
S3_BUCKET=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_REGION=
STORAGE_PROVIDER=s3
UPLOADS_BASE_URL=
UPLOADS_PUBLIC=false
UPLOADS_MAX_FILE_SIZE_MB=200
LOCAL_UPLOADS_DIR=./storage/uploads

##############################
# üí¨ WHATSAPP PROVIDER
##############################
WHATSAPP_API_URL=
WHATSAPP_API_KEY=
WHATSAPP_FROM_NUMBER=
WHATSAPP_TIMEOUT_MS=8000
WHATSAPP_PROVIDER=generic
WHATSAPP_TOKEN=
WHATSAPP_VERIFY_TOKEN=
WHATSAPP_PHONE_NUMBER_ID=
WHATSAPP_GRAPH_API_VERSION=v17.0

##############################
# üí¨ WHATSAPP ‚Äî CLOUD API (META) (webhook + respostas diretas)
##############################
WHATSAPP_META_TOKEN=
WHATSAPP_META_PHONE_NUMBER_ID=
WHATSAPP_WABA_ID=
# Habilita envio de aprova√ß√£o com bot√µes interativos (fallback para link em caso de erro).
WHATSAPP_APPROVAL_INTERACTIVE_ENABLED=true
# Exige valida√ß√£o de assinatura X-Hub-Signature-256 no webhook da Meta.
WHATSAPP_WEBHOOK_SIGNATURE_REQUIRED=false
# Habilita envio de resumo de performance no WhatsApp em schedules/reporting.
WHATSAPP_REPORT_SUMMARY_ENABLED=true

##############################
# üìä META / FACEBOOK ADS
##############################
META_GRAPH_BASE_URL=https://graph.facebook.com/v17.0
META_DEFAULT_FIELDS=impressions,clicks,spend
META_APP_ID=
META_APP_SECRET=
META_OAUTH_VERSION=v24.0
# Exemplo: https://api.seudominio.com/api/integrations/whatsapp/callback
META_OAUTH_REDIRECT_URI=
# Exemplo: https://api.seudominio.com/api/integrations/meta/callback
META_SOCIAL_REDIRECT_URI=
META_ADS_REDIRECT_URI=
META_SOCIAL_SCOPES=
META_ADS_SCOPES=
META_TOKEN_REFRESH_THRESHOLD_DAYS=7
META_IG_CONTAINER_POLL_ATTEMPTS=30
META_IG_CONTAINER_POLL_DELAY_MS=5000

##############################
# üìà GOOGLE ADS
##############################
GOOGLE_ADS_API_BASE_URL=https://googleads.googleapis.com/v14
GOOGLE_ADS_DEFAULT_FIELDS=metrics.impressions,metrics.clicks,metrics.cost_micros
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

##############################
# üìä REPORTING / DASHBOARDS
##############################
REPORTING_DEFAULT_RANGE_DAYS=30
REPORTING_CACHE_TTL_SECONDS=3600
REPORTING_SNAPSHOT_TTL_SECONDS=86400
REPORTING_JOB_ATTEMPTS=3
REPORTING_JOB_BACKOFF_MS=15000
REPORTING_TTL_META_ADS=3600
REPORTING_TTL_GOOGLE_ADS=3600
REPORTING_TTL_TIKTOK_ADS=3600
REPORTING_TTL_LINKEDIN_ADS=3600
REPORTING_TTL_GA4=3600
REPORTING_TTL_GBP=3600
REPORTING_TTL_META_SOCIAL=3600

##############################
# üìù AUDIT LOG (FASE 5)
##############################
AUDIT_LOG_ENABLED=false
AUDITLOG_SKIP_REGEX=^/health(z)?$|^/health$|^/api/auth
AUDITLOG_BODY_MAX=2000

##############################
# üí≥ CHECK SUBSCRIPTION (FASE 5)
##############################
CHECK_SUBSCRIPTION_ENABLED=true
ENFORCE_SUBSCRIPTION_CHECK=false

##############################
# üí≥ STRIPE
##############################
STRIPE_SECRET_KEY=

##############################
# üß∞ ADMIN SQL CONSOLE
##############################
ADMIN_SQL_ENABLED=false

##############################
# üìà TIKTOK
##############################
TIKTOK_CLIENT_KEY=
TIKTOK_CLIENT_SECRET=

##############################
# üß™ TESTES / E2E
##############################
PLAYWRIGHT_CHROMIUM_EXECUTABLE_PATH=
